A SQL query to find the average amount paid by the top 5 customers.

SELECT AVG(total_amount_paid.total_amount_paid) AS average_payment
FROM (SELECT
c.customer_id,
c.first_name,
c.last_name,
co.country,
ci.city,
SUM(p.amount) AS total_amount_paid
FROM customer c
JOIN payment p ON c.customer_id = p.customer_id
JOIN address a ON c.address_id = a.address_id
JOIN city ci ON a.city_id = ci.city_id
JOIN country co ON ci.country_id = co.country_id
WHERE ci.city IN (
SELECT ci.city
FROM customer c
JOIN address a ON c.address_id = a.address_id
JOIN city ci ON a.city_id = ci.city_id
GROUP BY ci.city
ORDER BY COUNT(c.customer_id) DESC
LIMIT 10
)
GROUP BY c.customer_id, c.first_name, c.last_name, co.country, ci.city
ORDER BY total_amount_paid DESC
LIMIT 5) AS total_amount_paid;
